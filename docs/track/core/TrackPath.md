# TrackPath

## Назначение

TrackPath строит 1D-представление трассы по чекпоинтам RaceTrack и даёт доступ к точкам на траектории по дуговой длине s. Скрипт помечен атрибутом RequireComponent(RaceTrack), поэтому должен висеть на том же объекте, что и RaceTrack.

## Поле looped

- looped — если true, траектория считается циклической и s повторяется по длине круговой трассы; если false, s будет клэмпиться в пределах 0..totalLen.

## Как работает Rebuild

Метод Rebuild пересчитывает внутренние массивы, когда меняется конфигурация чекпоинтов. Последовательность шагов:

1. Копируются ссылки на чекпоинты из RaceTrack в локальный массив cps и отдельный массив их позиций pts.
2. Для каждого сегмента между соседними точками вычисляется длина segLen и накапливается префиксная сумма prefix, из которой берётся totalLen.
3. Подготовленные массивы используются в остальных методах для быстрого поиска нужного сегмента и интерполяции позиции по длине дуги.

## Основные методы

- GetPoint(float s, float lateral) — возвращает позицию pos, направление dir и halfWidth в точке пути; lateral задаёт поперечное смещение в метрах, которое ограничивается внутри ширины дороги.
- GetClosestS(ref int hintIndex, Vector3 worldPos) — находит значение s, ближайшее к worldPos, начиная поиск от сегмента с индексом hintIndex (это ускоряет отслеживание уже едущей машины).
- EstimateCurvature(float s, float delta) — грубо оценивает кривизну участка трассы вокруг s, сравнивая направления трёх точек (s − delta, s, s + delta); чем выше значение, тем резче поворот.
